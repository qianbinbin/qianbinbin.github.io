<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.136.2"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><link rel=icon href=/favicons/favicon.svg><title>Best Time to Buy and Sell Stock III&nbsp;&ndash;&nbsp;Binac</title><link rel=stylesheet href=/css/core.min.d30edcc615d78b7f8a2a9e5f1b66bd074a7ad2e94b579fa5902d0967ce0f7684b300ef3a9e15d41af82c75f3fb951d4b.css integrity=sha384-0w7cxhXXi3+KKp5fG2a9B0p60ulLV5+lkC0JZ84PdoSzAO86nhXUGvgsdfP7lR1L><meta name=twitter:card content="summary">
<meta name=twitter:title content="Best Time to Buy and Sell Stock III"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><img class="site logo" src=/favicons/favicon.svg alt><span class="site name">Binac</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class='nav item active' href=/posts/ title=文章>文章</a>
<a class='nav item' href=/nonsense/ title=妄言>妄言</a>
<a class='nav item' href=/tuya/ title=涂鸦>涂鸦</a>
<a class='nav item' href=/tags/ title>标签</a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">Best Time to Buy and Sell Stock III</h1><p class="article date">2018-05-04</p></section><article class="article markdown-body"><p>股票买入卖出的最佳时间问题：
<a href=https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii/ target=_blank rel="noopener noreferrer">https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii/</a></p><blockquote><p>Say you have an array for which the ith element is the price of a given stock on day i.</p><p>Design an algorithm to find the maximum profit. You may complete at most two transactions.</p><p>Note: You may not engage in multiple transactions at the same time (i.e., you must sell the stock before you buy again).</p><p>Example 1:</p><p>Input: [3,3,5,0,0,3,1,4]
Output: 6
Explanation: Buy on day 4 (price = 0) and sell on day 6 (price = 3), profit = 3-0 = 3.
Then buy on day 7 (price = 1) and sell on day 8 (price = 4), profit = 4-1 = 3.</p><p>Example 2:</p><p>Input: [1,2,3,4,5]
Output: 4
Explanation: Buy on day 1 (price = 1) and sell on day 5 (price = 5), profit = 5-1 = 4.
Note that you cannot buy on day 1, buy on day 2 and sell them later, as you are
engaging multiple transactions at the same time. You must sell before buying again.</p><p>Example 3:</p><p>Input: [7,6,4,3,1]
Output: 0
Explanation: In this case, no transaction is done, i.e. max profit = 0.</p></blockquote><p>意即给定一个数组，数组下标表示时间，元素值表示股票价格，买入、卖出最多两次，且买入前必须先卖出，求最大利润。</p><h2 id=只买卖一次的情况>只买卖一次的情况</h2><p>与 <a href=https://leetcode.com/problems/best-time-to-buy-and-sell-stock/description/ target=_blank rel="noopener noreferrer">Best Time to Buy and Sell Stock - LeetCode</a> 不同的是，这道题可以买卖两次，而后者只能买卖一次。</p><p>对于只能买卖一次的情况，可以轻松求解：遍历数组，保存截止目前最小值，并不断更新最大利润，这也可以用动态规划来解释，递推公式为：</p><p>$$f(i) = \max\{f(i - 1), prices[i] - price_{min}\}$$</p><p>$price_{min}$ 也可以用递推公式表示：</p><p>$$price_{min}(i) = \min\{price_{min}(i - 1), prices[i]\}$$</p><h2 id=最多买卖两次的情况>最多买卖两次的情况</h2><p>对于最多买卖两次的情况，其实可以简单地看作买卖两次，当第一次卖出和第二次买入同时发生时，就可以看作是买卖一次的情况。因此，可以直接按照买卖两次处理。</p><p>为方便起见，用 $hold_1$、$release_1$ 分别表示第一次买入和卖出后的剩余资产，$hold_2$、$release_2$ 分别表示第二次买入和卖出后的剩余资产，我们的目标是使每次净资产最大化，最后得到的就是利润。</p><p>参考只允许买卖一次的问题，很容易得出以下递推公式：</p><p>$$release_1(i) = \max\{release_1(i - 1), prices[i] + hold_1(i - 1)\}$$</p><p>$$hold_1(i) = \max\{hold_1(i - 1), -prices[i]\}$$</p><p>第二次买卖递推公式：</p><p>$$release_2(i) = \max\{release_2(i - 1), prices[i] + hold_2(i - 1)\}$$</p><p>$$hold_2(i) = \max\{hold_2(i - 1), release_1(i - 1) - prices[i]\}$$</p><p>注意先后顺序，由于卖出时要用到之前买入的剩余资产，因此应先计算卖出，再计算买入。同样地，应先计算第二次买卖，再计算第一次买卖。如果顺序打乱，即使得到的结果是正确的，但算法思想就不对了。</p><p>如果对两次买卖都使用长度为 $n$ 的数组保存，空间复杂度就为 $O(n)$，但元素只利用一次，可以优化为 $O(n)$ 的空间复杂度。</p><h2 id=最多买卖-k-次的情况>最多买卖 k 次的情况</h2><p>明白了买卖两次的原理，就能很容易扩展到最多买卖 $k$ 次的情况，只需要把 $release_i$ 和 $hold_i$ 改为长度为 $k$ 的数组，更新步骤写成一个 $k$ 次的循环即可。</p><p>这就是 <a href=https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iv/description/ target=_blank rel="noopener noreferrer">Best Time to Buy and Sell Stock IV - LeetCode</a> 的思路。</p><h2 id=实现源码>实现源码</h2><p><a href=https://github.com/qianbinbin/leetcode target=_blank rel="noopener noreferrer">https://github.com/qianbinbin/leetcode</a></p><h2 id=参考资料>参考资料</h2><ol><li><a href=https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii/discuss/39611/Is-it-Best-Solution-with-O%28n%29-O%281%29. target=_blank rel="noopener noreferrer">Is it Best Solution with O(n), O(1). - LeetCode Discuss</a></li></ol></article><section class="article labels"><a class=tag href=/tags/leetcode/>LeetCode</a><a class=tag href=/tags/%E7%AE%97%E6%B3%95/>算法</a><a class=tag href=/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/>动态规划</a></section><section class="article license"><p xmlns:cc=http://creativecommons.org/ns# style=text-align:center>本作品根据 <a href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel="license noopener noreferrer" style=display:inline-block>署名-非商业性使用-相同方式共享 4.0 国际许可<img style=height:15px!important;margin-left:1px;vertical-align:text-bottom src=/cc-icons/cc.svg><img style=height:15px!important;margin-left:1px;vertical-align:text-bottom src=/cc-icons/by.svg><img style=height:15px!important;margin-left:1px;vertical-align:text-bottom src=/cc-icons/nc.svg><img style=height:15px!important;margin-left:1px;vertical-align:text-bottom src=/cc-icons/sa.svg></a> 进行授权。</p></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/posts/leetcode-categories/><span class="iconfont icon-article"></span>LeetCode 个人分类</a></p><p><a class=link href=/posts/sqrt/><span class="iconfont icon-article"></span>牛顿法实现开平方 sqrt</a></p></section><section class="article discussion"><script>function loadComment(){let e=document.createElement("script");e.src="https://utteranc.es/client.js",e.setAttribute("repo","qianbinbin/qianbinbin.github.io"),e.setAttribute("issue-term","pathname"),e.setAttribute("theme","preferred-color-scheme"),e.setAttribute("crossorigin","anonymous"),e.setAttribute("async",""),document.querySelector("section.article.discussion").innerHTML="",document.querySelector("section.article.discussion").appendChild(e)}loadComment(),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{loadComment()})</script></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>© 2017-2024 Binac.</p></div></section><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css integrity=sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js integrity=sha384-YNHdsYkH6gMx9y3mRkmcJ2mFUjTd0qNQQvY9VYZgQd7DcN7env35GzlmFaZ23JGp crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-N7VZY53PLB"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-N7VZY53PLB")}</script><script src=https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script><script>addBackToTop({diameter:42})</script></body></html>