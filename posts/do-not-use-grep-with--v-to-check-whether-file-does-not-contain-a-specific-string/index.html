<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.136.2"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><link rel=icon href=/favicons/favicon.svg><title>不要使用 grep -v 来检查文件是否不包含特定字符串&nbsp;&ndash;&nbsp;Binac</title><link rel=stylesheet href=/css/core.min.d30edcc615d78b7f8a2a9e5f1b66bd074a7ad2e94b579fa5902d0967ce0f7684b300ef3a9e15d41af82c75f3fb951d4b.css integrity=sha384-0w7cxhXXi3+KKp5fG2a9B0p60ulLV5+lkC0JZ84PdoSzAO86nhXUGvgsdfP7lR1L><meta name=twitter:card content="summary">
<meta name=twitter:title content="不要使用 grep -v 来检查文件是否不包含特定字符串"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><img class="site logo" src=/favicons/favicon.svg alt><span class="site name">Binac</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class='nav item active' href=/posts/ title=文章>文章</a>
<a class='nav item' href=/nonsense/ title=妄言>妄言</a>
<a class='nav item' href=/tuya/ title=涂鸦>涂鸦</a>
<a class='nav item' href=/tags/ title>标签</a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">不要使用 grep -v 来检查文件是否不包含特定字符串</h1><p class="article date">2024-01-02</p></section><article class="article markdown-body"><p>新年第一水。</p><p>刷到 StackOverflow 上一个回答<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>：</p><span class=image-container><span class=link><a href=/images/do-not-use-grep-with--v-to-check-whether-file-does-not-contain-a-specific-string/answer.png target=_blank><img class=img src=/images/do-not-use-grep-with--v-to-check-whether-file-does-not-contain-a-specific-string/answer.png></a></span></span><p>回答没毛病，但是底下这个点评的 Tom Harrison 言之凿凿地说，可以使用 <code>-v</code> 来反转条件……真是如此？</p><p>假设有一个文件 <code>test</code>，内容如下：</p><pre tabindex=0><code>a
b
</code></pre><p>先查找文件中<strong>不存在</strong>的字符串 <code>c</code> 试试：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ grep c test<span class=p>;</span> <span class=nb>echo</span> <span class=nv>$?</span>
</span></span><span class=line><span class=cl><span class=m>1</span>
</span></span><span class=line><span class=cl>$ ! grep c test<span class=p>;</span> <span class=nb>echo</span> <span class=nv>$?</span>
</span></span><span class=line><span class=cl><span class=m>0</span>
</span></span><span class=line><span class=cl>$ grep -v c test<span class=p>;</span> <span class=nb>echo</span> <span class=nv>$?</span>
</span></span><span class=line><span class=cl>a
</span></span><span class=line><span class=cl>b
</span></span><span class=line><span class=cl><span class=m>0</span>
</span></span></code></pre></div><p>似乎没问题，两种都对。</p><p>再查找文件中<strong>存在</strong>的字符串 <code>a</code> 呢：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ grep a test<span class=p>;</span> <span class=nb>echo</span> <span class=nv>$?</span>
</span></span><span class=line><span class=cl>a
</span></span><span class=line><span class=cl><span class=m>0</span>
</span></span><span class=line><span class=cl>$ ! grep a test<span class=p>;</span> <span class=nb>echo</span> <span class=nv>$?</span>
</span></span><span class=line><span class=cl>a
</span></span><span class=line><span class=cl><span class=m>1</span>
</span></span><span class=line><span class=cl>$ grep -v a test<span class=p>;</span> <span class=nb>echo</span> <span class=nv>$?</span>
</span></span><span class=line><span class=cl>b
</span></span><span class=line><span class=cl><span class=m>0</span>
</span></span></code></pre></div><p>扯犊子了吧？</p><p>原因就在于，<code>-v</code> 反转的是查找条件，而不是查找结果。GNU grep 的手册是这么解释 <code>-v</code> 的：</p><pre tabindex=0><code>       -v, --invert-match
              Invert the sense of matching, to select non-matching lines.
</code></pre><p><code>-v</code> 会匹配那些不包含 <code>a</code> 的行，自然 <code>b</code> 就被查找出来了。</p><p>你可以说这人的意思是 <code>-v</code> 可以反转查找条件，问题是这里是 <code>if</code> 语句，要根据结果的条件来判断，然后进行其他操作，明显这人以为 <code>-v</code> 和 <code>!</code> 是一样的效果。这种点评带有很大的误导性。</p><p>那么 <code>-v</code> 能不能实现类似的功能呢？其实是可以的，只不过要结合自己的使用情境配合复杂一点的正则罢了，没必要。</p><p>多句嘴，StackOverflow 这个网站虽然很有用，但是对用户并不友好。</p><p>我连点赞的权限都没有，还有很多人在瞎点评，而且还是错误的。</p><p>有时好不容易搜到一个和自己类似问题，然后就有人点评让你去看某些要么屁用没有要么一堆冗余信息的链接，还说不要重复提问 blah blah……贼烦这种伪精英主义。</p><p>我靠，这么水的文章还是什么时候删了吧……</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://stackoverflow.com/a/57158235 target=_blank rel="noopener noreferrer">https://stackoverflow.com/a/57158235</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><section class="article labels"><a class=tag href=/tags/shell/>Shell</a><a class=tag href=/tags/linux/>Linux</a></section><section class="article license"><p xmlns:cc=http://creativecommons.org/ns# style=text-align:center>本作品根据 <a href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel="license noopener noreferrer" style=display:inline-block>署名-非商业性使用-相同方式共享 4.0 国际许可<img style=height:15px!important;margin-left:1px;vertical-align:text-bottom src=/cc-icons/cc.svg><img style=height:15px!important;margin-left:1px;vertical-align:text-bottom src=/cc-icons/by.svg><img style=height:15px!important;margin-left:1px;vertical-align:text-bottom src=/cc-icons/nc.svg><img style=height:15px!important;margin-left:1px;vertical-align:text-bottom src=/cc-icons/sa.svg></a> 进行授权。</p></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/posts/download-an-old-version-of-chrome/><span class="iconfont icon-article"></span>下载官方旧版本 Chrome</a></p><p><a class=link href=/posts/video-related-commands-and-scripts/><span class="iconfont icon-article"></span>视频相关的命令和脚本</a></p></section><section class="article discussion"><script>function loadComment(){let e=document.createElement("script");e.src="https://utteranc.es/client.js",e.setAttribute("repo","qianbinbin/qianbinbin.github.io"),e.setAttribute("issue-term","pathname"),e.setAttribute("theme","preferred-color-scheme"),e.setAttribute("crossorigin","anonymous"),e.setAttribute("async",""),document.querySelector("section.article.discussion").innerHTML="",document.querySelector("section.article.discussion").appendChild(e)}loadComment(),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{loadComment()})</script></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>© 2017-2024 Binac.</p></div></section><script async src="https://www.googletagmanager.com/gtag/js?id=G-N7VZY53PLB"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-N7VZY53PLB")}</script><script src=https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script><script>addBackToTop({diameter:42})</script></body></html>