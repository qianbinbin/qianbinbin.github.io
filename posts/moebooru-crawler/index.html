<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.136.2"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><link rel=icon href=/favicons/favicon.svg><title>Y 站、K 站下载器 moebooru-crawler&nbsp;&ndash;&nbsp;Binac</title><link rel=stylesheet href=/css/core.min.d30edcc615d78b7f8a2a9e5f1b66bd074a7ad2e94b579fa5902d0967ce0f7684b300ef3a9e15d41af82c75f3fb951d4b.css integrity=sha384-0w7cxhXXi3+KKp5fG2a9B0p60ulLV5+lkC0JZ84PdoSzAO86nhXUGvgsdfP7lR1L><meta name=twitter:card content="summary">
<meta name=twitter:title content="Y 站、K 站下载器 moebooru-crawler"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><img class="site logo" src=/favicons/favicon.svg alt><span class="site name">Binac</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class='nav item active' href=/posts/ title=文章>文章</a>
<a class='nav item' href=/nonsense/ title=妄言>妄言</a>
<a class='nav item' href=/tuya/ title=涂鸦>涂鸦</a>
<a class='nav item' href=/tags/ title>标签</a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">Y 站、K 站下载器 moebooru-crawler</h1><p class="article date">2021-06-29</p></section><article class="article markdown-body"><p>Shell 脚本，用来获取基于 moebooru 的网站上的原图链接，如 yande.re、konachan.com 等。</p><h2 id=下载>下载</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ curl -O <span class=s2>&#34;https://github.com/qianbinbin/moebooru-crawler/raw/master/moebooru-crawler.sh&#34;</span>
</span></span><span class=line><span class=cl>$ <span class=c1># git clone git@github.com:qianbinbin/moebooru-crawler.git &amp;&amp; cd moebooru-crawler</span>
</span></span><span class=line><span class=cl>$ chmod +x ./moebooru-crawler.sh
</span></span></code></pre></div><h2 id=使用>使用</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>Usage: moebooru-crawler URL <span class=o>[</span> -n NUM, --num<span class=o>=</span>NUM <span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  -n NUM, --num<span class=o>=</span>NUM         print NUM links of images,
</span></span><span class=line><span class=cl>                            or print all <span class=k>if</span> NUM is <span class=s1>&#39;0&#39;</span>
</span></span></code></pre></div><h3 id=示例>示例</h3><h4 id=获取指定页面上的图片链接>获取指定页面上的图片链接</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ ./moebooru-crawler.sh <span class=s2>&#34;https://yande.re/post?tags=coffee-kizoku+order%3Ascore&#34;</span>
</span></span></code></pre></div><h4 id=将链接保存到文件>将链接保存到文件</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ ./moebooru-crawler.sh <span class=s2>&#34;https://yande.re/post?tags=coffee-kizoku+order%3Ascore&#34;</span> &gt;&gt;links.txt
</span></span></code></pre></div><p>然后可以用 aria2c 之类的工具批量下载。</p><h4 id=获取指定数量的图片当页面多于一页时>获取指定数量的图片（当页面多于一页时）</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ ./moebooru-crawler.sh <span class=s2>&#34;https://yande.re/post?page=2&amp;tags=coffee-kizoku&#34;</span> -n <span class=m>100</span>  <span class=c1># &#34;page=2&#34; 会被忽略</span>
</span></span></code></pre></div><p>要下载所有页面上的图片，使用 <code>-n 0</code> 即可：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ ./moebooru-crawler.sh <span class=s2>&#34;https://yande.re/post?tags=coffee-kizoku&#34;</span> -n <span class=m>0</span>
</span></span></code></pre></div><h2 id=源码>源码</h2><p><a href=https://github.com/qianbinbin/moebooru-crawler target=_blank rel="noopener noreferrer">https://github.com/qianbinbin/moebooru-crawler</a></p><figure style="margin:0 0 1.5em"><figcaption style=text-align:right><a href=/code/moebooru-crawler/moebooru-crawler.sh style=color:lightslategrey;font-size:.8em>moebooru-crawler.sh</a></figcaption><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/usr/bin/env sh
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nv>NUM</span><span class=o>=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>USAGE</span><span class=o>=</span><span class=k>$(</span>
</span></span><span class=line><span class=cl>  cat <span class=s>&lt;&lt;-END
</span></span></span><span class=line><span class=cl><span class=s>Usage: moebooru-crawler URL [ -n NUM, --num=NUM ]
</span></span></span><span class=line><span class=cl><span class=s>
</span></span></span><span class=line><span class=cl><span class=s>  -n NUM, --num=NUM         print NUM links of images,
</span></span></span><span class=line><span class=cl><span class=s>                            or print all if NUM is &#39;0&#39;
</span></span></span><span class=line><span class=cl><span class=s>END</span>
</span></span><span class=line><span class=cl><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>error<span class=o>()</span> <span class=o>{</span> <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span>2<span class=p>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>_exit<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  error <span class=s2>&#34;</span><span class=nv>$USAGE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nb>exit</span> <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=o>[</span> <span class=nv>$#</span> -gt <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> in
</span></span><span class=line><span class=cl>  -n <span class=p>|</span> --num<span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>[</span> -n <span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=o>||</span> _exit
</span></span><span class=line><span class=cl>    <span class=nv>NUM</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$2</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>shift</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl>  -n<span class=o>=</span>* <span class=p>|</span> --num<span class=o>=</span>*<span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>NUM</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>1</span><span class=p>#*=</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>shift</span>
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl>  -*<span class=o>)</span>
</span></span><span class=line><span class=cl>    _exit
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl>  *<span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>[</span> -z <span class=s2>&#34;</span><span class=nv>$URL</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=o>||</span> _exit
</span></span><span class=line><span class=cl>    <span class=nv>URL</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>shift</span>
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl>  <span class=k>esac</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> -n <span class=s2>&#34;</span><span class=nv>$NUM</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$NUM</span><span class=s2>&#34;</span> -ge <span class=m>0</span> <span class=o>]</span> 2&gt;/dev/null <span class=o>||</span> _exit
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>[</span> -n <span class=s2>&#34;</span><span class=nv>$URL</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=o>||</span> _exit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>get_links<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>content</span><span class=o>=</span><span class=k>$(</span>curl -fsSL <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$content</span><span class=s2>&#34;</span> <span class=p>|</span> grep -o <span class=s1>&#39;file_url=&#34;[^&#34;]*&#39;</span> <span class=p>|</span> grep -o <span class=s1>&#39;http[^&#34;]*&#39;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$URL</span><span class=s2>&#34;</span> <span class=p>|</span> grep -qs <span class=s1>&#39;?&#39;</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nv>path</span><span class=o>=</span><span class=si>${</span><span class=nv>URL</span><span class=p>%%</span><span class=se>\?</span><span class=p>*</span><span class=si>}</span>.xml
</span></span><span class=line><span class=cl>  <span class=nv>query</span><span class=o>=</span><span class=si>${</span><span class=nv>URL</span><span class=p>#*</span><span class=se>\?</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=nv>path</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$URL</span><span class=s2>.xml&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nv>query</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>links</span><span class=o>=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> -z <span class=s2>&#34;</span><span class=nv>$NUM</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nv>url</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$path</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> -n <span class=s2>&#34;</span><span class=nv>$query</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=nv>url</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$url</span><span class=s2>?</span><span class=nv>$query</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nv>links</span><span class=o>=</span><span class=k>$(</span>get_links <span class=s2>&#34;</span><span class=nv>$url</span><span class=s2>&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=nv>query</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$query</span><span class=s2>&#34;</span> <span class=p>|</span> sed <span class=s2>&#34;s/&amp;\?page=[0-9]*//g&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> -n <span class=s2>&#34;</span><span class=nv>$query</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=nv>query</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$query</span><span class=s2>&amp;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nv>page</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$NUM</span><span class=s2>&#34;</span> -eq <span class=m>0</span> <span class=o>]</span> <span class=o>||</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$links</span><span class=s2>&#34;</span> <span class=p>|</span> wc -w<span class=k>)</span><span class=s2>&#34;</span> -lt <span class=s2>&#34;</span><span class=nv>$NUM</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nv>p</span><span class=o>=</span><span class=s2>&#34;page=</span><span class=nv>$page</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>url</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$path</span><span class=s2>?</span><span class=nv>$query$p</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>_links</span><span class=o>=</span><span class=k>$(</span>get_links <span class=s2>&#34;</span><span class=nv>$url</span><span class=s2>&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=o>[</span> <span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$_links</span><span class=s2>&#34;</span> <span class=p>|</span> wc -w<span class=k>)</span><span class=s2>&#34;</span> -eq <span class=m>0</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=nb>break</span>
</span></span><span class=line><span class=cl>    <span class=nv>links</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$links</span><span class=s2> </span><span class=nv>$_links</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    : <span class=k>$((</span><span class=nv>page</span> <span class=o>=</span> page <span class=o>+</span> <span class=m>1</span><span class=k>))</span>
</span></span><span class=line><span class=cl>  <span class=k>done</span>
</span></span><span class=line><span class=cl>  <span class=nv>links</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$links</span><span class=s2>&#34;</span> <span class=p>|</span> xargs -n 1<span class=k>)</span>
</span></span><span class=line><span class=cl>  <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$NUM</span><span class=s2>&#34;</span> -eq <span class=m>0</span> <span class=o>]</span> <span class=o>||</span> <span class=nv>links</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$links</span><span class=s2>&#34;</span> <span class=p>|</span> head -n <span class=s2>&#34;</span><span class=nv>$NUM</span><span class=s2>&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$links</span><span class=s2>&#34;</span>
</span></span></code></pre></div></figure></article><section class="article labels"><a class=tag href=/tags/macos/>macOS</a><a class=tag href=/tags/linux/>Linux</a><a class=tag href=/tags/shell/>Shell</a></section><section class="article license"><p xmlns:cc=http://creativecommons.org/ns# style=text-align:center>本作品根据 <a href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank rel="license noopener noreferrer" style=display:inline-block>署名-非商业性使用-相同方式共享 4.0 国际许可<img style=height:15px!important;margin-left:1px;vertical-align:text-bottom src=/cc-icons/cc.svg><img style=height:15px!important;margin-left:1px;vertical-align:text-bottom src=/cc-icons/by.svg><img style=height:15px!important;margin-left:1px;vertical-align:text-bottom src=/cc-icons/nc.svg><img style=height:15px!important;margin-left:1px;vertical-align:text-bottom src=/cc-icons/sa.svg></a> 进行授权。</p></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/posts/dnsmasq-to-kill-dns-hijacking-and-ads/><span class="iconfont icon-article"></span>Dnsmasq 去 DNS 污染和广告</a></p><p><a class=link href=/posts/macos-clean-dumb-dotfiles/><span class="iconfont icon-article"></span>macOS 清除 ._*、.DS_Store 隐藏垃圾文件</a></p></section><section class="article discussion"><script>function loadComment(){let e=document.createElement("script");e.src="https://utteranc.es/client.js",e.setAttribute("repo","qianbinbin/qianbinbin.github.io"),e.setAttribute("issue-term","pathname"),e.setAttribute("theme","preferred-color-scheme"),e.setAttribute("crossorigin","anonymous"),e.setAttribute("async",""),document.querySelector("section.article.discussion").innerHTML="",document.querySelector("section.article.discussion").appendChild(e)}loadComment(),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{loadComment()})</script></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>© 2017-2024 Binac.</p></div></section><script async src="https://www.googletagmanager.com/gtag/js?id=G-N7VZY53PLB"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-N7VZY53PLB")}</script><script src=https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script><script>addBackToTop({diameter:42})</script></body></html>